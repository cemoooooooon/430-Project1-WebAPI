<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Pokémon API Tester</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav>
    <a href="/">Home</a>
    <!-- no docs yet, but still placeholder -->
    <a href="/docs">API Docs</a>
  </nav>
  <h1>Pokémon API Tester</h1>
  <p class="note">This page sends <code>Accept: application/json</code>. POST can send either JSON or <code>application/x-www-form-urlencoded</code>.</p>

  <!-- GET /pokemon -->
  <fieldset>
    <legend>GET/HEAD /pokemon (filter, search, paging)</legend>
    <div class="row">
      <label for="type">type=</label>
      <input id="type" type="text" placeholder="fire" />
      <label for="search">search=</label>
      <input id="search" type="text" placeholder="chu" />
      <label for="limit">limit=</label>
      <input id="limit" type="number" value="10" />
      <label for="offset">offset=</label>
      <input id="offset" type="number" value="0" />
      <button id="btnPokemonGet">GET</button>
      <button id="btnPokemonHead">HEAD</button>
    </div>
  </fieldset>

  <!-- GET /pokemon/by -->
  <fieldset>
    <legend>GET/HEAD /pokemon/by (id or name)</legend>
    <div class="row">
      <label for="byId">id=</label>
      <input id="byId" type="number" placeholder="25" />
      <label for="byName">name=</label>
      <input id="byName" type="text" placeholder="pikachu" />
      <button id="btnByGet">GET</button>
      <button id="btnByHead">HEAD</button>
    </div>
  </fieldset>

  <!-- GET /types -->
  <fieldset>
    <legend>GET/HEAD /types (unique types)</legend>
    <div class="row">
      <button id="btnTypesGet">GET</button>
      <button id="btnTypesHead">HEAD</button>
    </div>
  </fieldset>

  <!-- GET /pokemon/random -->
<fieldset>
  <legend>GET/HEAD /pokemon/random (random selection)</legend>
  <div class="row">
    <label for="randCount">count=</label>
    <input id="randCount" type="number" value="1" min="1" />
    <button id="btnRandomGet">GET</button>
    <button id="btnRandomHead">HEAD</button>
  </div>
  <p class="note">If omitted or invalid, the server defaults to 1. The server count caps at 50.</p>
</fieldset>


  <!-- POST /pokemon/add -->
  <fieldset>
    <legend>POST /pokemon/add (create)</legend>
    <div class="row">
      <label for="addId">id *</label>
      <input id="addId" type="number" placeholder="152" />
      <label for="addName">name *</label>
      <input id="addName" type="text" placeholder="mewthree" />
    </div>
    <div class="row">
      <label for="addType">type</label>
      <input id="addType" type="text" placeholder="electric" />
      <select id="addContentType">
        <option value="json">application/json</option>
        <option value="form">application/x-www-form-urlencoded</option>
      </select>
      <button id="btnAdd">POST</button>
    </div>
    <p class="note">For JSON, types are sent as an array; for form, types are sent as a comma-separated string.</p>
  </fieldset>

  <!-- POST /pokemon/update -->
  <fieldset>
    <legend>POST /pokemon/update (edit existing → 204)</legend>
    <div class="row">
      <label for="updId">id *</label>
      <input id="updId" type="number" placeholder="25" />
      <label for="updField">field *</label>
      <input id="updField" type="text" placeholder="hp" />
      <label for="updValue">value *</label>
      <input id="updValue" type="text" placeholder="42" />
      <select id="updContentType">
        <option value="json">application/json</option>
        <option value="form">application/x-www-form-urlencoded</option>
      </select>
      <button id="btnUpdate">POST</button>
    </div>
  </fieldset>

  <h2>Response</h2>
  <pre id="out">—</pre>

  <script>
    const $ = (id) => document.getElementById(id);
    const out = $('out');

    const show = async (res) => {
      const headers = {};
      res.headers.forEach((v, k) => { headers[k] = v; });

      let bodyText = '';
      try { bodyText = await res.text(); } catch (e) { bodyText = `<read error: ${e?.message || e}>`; }

      let parsed;
      try { parsed = bodyText ? JSON.parse(bodyText) : null; } catch { parsed = bodyText; }

      out.textContent = JSON.stringify({
        url: res.url,
        ok: res.ok,
        status: res.status,
        statusText: res.statusText,
        headers,
        body: parsed,
      }, null, 2);
    };

    const GET  = (url) => fetch(url, { method: 'GET',  headers: { 'Accept': 'application/json' }});
    const HEAD = (url) => fetch(url, { method: 'HEAD', headers: { 'Accept': 'application/json' }});

    const POST_JSON = (url, obj) => fetch(url, {
      method: 'POST',
      headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' },
      body: JSON.stringify(obj || {})
    });

    const POST_FORM = (url, obj) => fetch(url, {
      method: 'POST',
      headers: { 'Accept': 'application/json', 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams(obj || {}).toString()
    });

    // /pokemon
    $('btnPokemonGet').onclick = async () => {
      const qs = new URLSearchParams();
      const type   = $('type').value.trim();
      const search = $('search').value.trim();
      const limit  = $('limit').value;
      const offset = $('offset').value;
      if (type) qs.set('type', type);
      if (search) qs.set('search', search);
      if (limit !== '') qs.set('limit', limit);
      if (offset !== '') qs.set('offset', offset);

      const res = await GET(`/pokemon${qs.toString() ? `?${qs}` : ''}`);
      show(res);
    };

    $('btnPokemonHead').onclick = async () => {
      const qs = new URLSearchParams();
      const type   = $('type').value.trim();
      const search = $('search').value.trim();
      const limit  = $('limit').value;
      const offset = $('offset').value;
      if (type) qs.set('type', type);
      if (search) qs.set('search', search);
      if (limit !== '') qs.set('limit', limit);
      if (offset !== '') qs.set('offset', offset);

      const res = await HEAD(`/pokemon${qs.toString() ? `?${qs}` : ''}`);
      show(res);
    };

    // /pokemon/by
    $('btnByGet').onclick = async () => {
      const id   = $('byId').value.trim();
      const name = $('byName').value.trim();
      const qs = new URLSearchParams();
      if (id) qs.set('id', id);
      if (name) qs.set('name', name);
      const res = await GET(`/pokemon/by${qs.toString() ? `?${qs}` : ''}`);
      show(res);
    };

    $('btnByHead').onclick = async () => {
      const id   = $('byId').value.trim();
      const name = $('byName').value.trim();
      const qs = new URLSearchParams();
      if (id) qs.set('id', id);
      if (name) qs.set('name', name);
      const res = await HEAD(`/pokemon/by${qs.toString() ? `?${qs}` : ''}`);
      show(res);
    };

    // /types
    $('btnTypesGet').onclick = async () => {
      const res = await GET('/types');
      show(res);
    };
    $('btnTypesHead').onclick = async () => {
      const res = await HEAD('/types');
      show(res);
    };

    // /pokemon/random
  document.getElementById('btnRandomGet').onclick = async () => {
    var n = document.getElementById('randCount').value;
    var qs = new URLSearchParams();
    if (n !== '') qs.set('count', n);
    var res = await GET('/pokemon/random' + (qs.toString() ? ('?' + qs.toString()) : ''));
    show(res);
  };

  document.getElementById('btnRandomHead').onclick = async () => {
    var n = document.getElementById('randCount').value;
    var qs = new URLSearchParams();
    if (n !== '') qs.set('count', n);
    var res = await HEAD('/pokemon/random' + (qs.toString() ? ('?' + qs.toString()) : ''));
    show(res);
  };

    // POST /pokemon/add
    $('btnAdd').onclick = async () => {
      const id   = $('addId').value.trim();
      const name = $('addName').value.trim();
      const type = $('addType').value.trim();
      const mode = $('addContentType').value;

      if (!id || !name) {
        out.textContent = 'Please provide id and name.';
        return;
      }

      if (mode === 'json') {
        const payload = { id: Number(id), name };
        if (type) {
          payload.type = type.split(',').map(s => s.trim()).filter(Boolean);
        }
        const res = await POST_JSON('/pokemon/add', payload);
        show(res);
      } else {
        // urlencoded: types as comma separated string
        const payload = { id, name };
        if (type) payload.type = type;
        const res = await POST_FORM('/pokemon/add', payload);
        show(res);
      }
    };

    // POST /pokemon/update
    $('btnUpdate').onclick = async () => {
      const id    = $('updId').value.trim();
      const field = $('updField').value.trim();
      const value = $('updValue').value.trim();
      const mode  = $('updContentType').value;

      if (!id || !field) {
        out.textContent = 'Provide id and at least one field/value.';
        return;
      }

      if (mode === 'json') {
        const payload = { id: Number(id) };
        // try number, else send as string
        const n = Number(value);
        payload[field] = Number.isNaN(n) ? value : n;
        const res = await POST_JSON('/pokemon/update', payload);
        show(res);
      } else {
        const payload = { id, [field]: value };
        const res = await POST_FORM('/pokemon/update', payload);
        show(res);
      }
    };
  </script>
</body>
</html>
