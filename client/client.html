<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Pokémon API</title>
  <link rel="stylesheet" href="/style.css" />
</head>

<body>
  <div class="mainContent">
    <a href="/">Test the Application Here</a><br />
    <a href="/docs">View the Documentation Here</a>

    <h1>Pokémon API Application</h1>

    <!-- /pokemon -->
    <div class="endpoint">
      <h2 class="collapsible">
        /pokemon <span class="methods"><code>GET</code> <code>HEAD</code></span>
      </h2>
      <div class="content">
        <div class="content-box">
          <h3>Query Params</h3>
          <p class="param"><code>type</code> (optional) – filter by a type (e.g., <code>fire</code>).</p>
          <p class="param"><code>search</code> (optional) – case-insensitive name contains.</p>
          <p class="param"><code>limit</code> (optional) – default 50, max 100.</p>
          <p class="param"><code>offset</code> (optional) – default 0.</p>

          <h3>Try it</h3>
          <section class="example">
            <div class="row">
              <label for="type">type=</label>
              <input id="type" type="text" placeholder="fire" />
              <label for="search">search=</label>
              <input id="search" type="text" placeholder="chu" />
              <label for="limit">limit=</label>
              <input id="limit" type="number" value="10" />
              <label for="offset">offset=</label>
              <input id="offset" type="number" value="0" />
              <button id="btnPokemonGet">GET</button>
              <button id="btnPokemonHead">HEAD</button>
            </div>
          </section>

          <h3>Returns</h3>
          <p class="param">JSON object: <code>{ count: number, offset: number, limit: number, data: [Pokemon] }</code></p>
        </div>
      </div>
    </div>

    <!-- /pokemon/by -->
    <div class="endpoint">
      <h2 class="collapsible">
        /pokemon/by <span class="methods"><code>GET</code> <code>HEAD</code></span>
      </h2>
      <div class="content">
        <div class="content-box">
          <h3>Query Params</h3>
          <p class="param"><code>id</code> (one of id or name is required)</p>
          <p class="param"><code>name</code> (one of id or name is required)</p>

          <h3>Try it</h3>
          <section class="example">
            <div class="row">
              <label for="byId">id=</label>
              <input id="byId" type="number" placeholder="25" />
              <label for="byName">name=</label>
              <input id="byName" type="text" placeholder="pikachu" />
              <button id="btnByGet">GET</button>
              <button id="btnByHead">HEAD</button>
            </div>
          </section>

          <h3>Returns</h3>
          <p class="param">JSON: single Pokémon object, or <code>400</code>/<code>404</code> error JSON.</p>
        </div>
      </div>
    </div>

    <!-- /types -->
    <div class="endpoint">
      <h2 class="collapsible">
        /types <span class="methods"><code>GET</code> <code>HEAD</code></span>
      </h2>
      <div class="content">
        <div class="content-box">
          <h3>Query Params</h3>
          <p class="param">No supported params</p>

          <h3>Try it</h3>
          <section class="example">
            <div class="row">
              <button id="btnTypesGet">GET</button>
              <button id="btnTypesHead">HEAD</button>
            </div>
          </section>

          <h3>Returns</h3>
          <p class="param">JSON: <code>{ count: number, types: [string] }</code></p>
        </div>
      </div>
    </div>

    <!-- /pokemon/random -->
    <div class="endpoint">
      <h2 class="collapsible">
        /pokemon/random <span class="methods"><code>GET</code> <code>HEAD</code></span>
      </h2>
      <div class="content">
        <div class="content-box">
          <h3>Query Params</h3>
          <p class="param"><code>count</code> (optional) – default 1, capped (e.g., 50).</p>

          <h3>Try it</h3>
          <section class="example">
            <div class="row">
              <label for="randCount">count=</label>
              <input id="randCount" type="number" value="1" min="1" />
              <button id="btnRandomGet">GET</button>
              <button id="btnRandomHead">HEAD</button>
            </div>
          </section>

          <h3>Returns</h3>
          <p class="param">JSON: <code>{ count: number, data: [Pokemon] }</code></p>
        </div>
      </div>
    </div>

    <!-- /pokemon/add -->
    <div class="endpoint">
      <h2 class="collapsible">
        /pokemon/add <span class="methods"><code>POST</code></span>
      </h2>
      <div class="content">
        <div class="content-box">
          <h3>Supported Body Formats</h3>
          <p class="param"><code>application/json</code> <code>application/x-www-form-urlencoded</code></p>

          <h3>Body Params</h3>
          <p class="param"><code>id</code> Type: <code>number</code> – required.</p>
          <p class="param"><code>name</code> Type: <code>string</code> – required.</p>
          <p class="param"><code>type</code> Type: <code>string[]</code> or comma string – optional.</p>

          <h3>Try it</h3>
          <section class="example">
            <div class="row">
              <label for="addId">id *</label>
              <input id="addId" type="number" placeholder="152" />
              <label for="addName">name *</label>
              <input id="addName" type="text" placeholder="mewthree" />
            </div>
            <div class="row">
              <label for="addType">type</label>
              <input id="addType" type="text" placeholder="electric" />
              <select id="addContentType">
                <option value="json">application/json</option>
                <option value="form">application/x-www-form-urlencoded</option>
              </select>
              <button id="btnAdd">POST</button>
            </div>
            <p class="param">JSON sends <code>type</code> as an array; form sends it as a comma-separated string.</p>
          </section>

          <h3>Returns</h3>
          <p class="param">JSON: <code>{ message: string, data: Pokemon }</code> or <code>400</code> error JSON.</p>
        </div>
      </div>
    </div>

    <!-- /pokemon/update -->
    <div class="endpoint">
      <h2 class="collapsible">
        /pokemon/update <span class="methods"><code>POST</code></span>
      </h2>
      <div class="content">
        <div class="content-box">
          <h3>Supported Body Formats</h3>
          <p class="param"><code>application/json</code> <code>application/x-www-form-urlencoded</code></p>

          <h3>Body Params</h3>
          <p class="param"><code>id</code> Type: <code>number</code> – required (record to edit).</p>
          <p class="param"><em>Any other field</em> – updated value (e.g., <code>hp</code>).</p>

          <h3>Try it</h3>
          <section class="example">
            <div class="row">
              <label for="updId">id *</label>
              <input id="updId" type="number" placeholder="25" />
              <label for="updField">field *</label>
              <input id="updField" type="text" placeholder="hp" />
              <label for="updValue">value *</label>
              <input id="updValue" type="text" placeholder="42" />
              <select id="updContentType">
                <option value="json">application/json</option>
                <option value="form">application/x-www-form-urlencoded</option>
              </select>
              <button id="btnUpdate">POST</button>
            </div>
          </section>

          <h3>Returns</h3>
          <p class="param"><code>204 No Content</code> on success; <code>400</code>/<code>404</code> error JSON otherwise.</p>
        </div>
      </div>
    </div>

    <h2>Response</h2>
    <pre id="out" class="result">—</pre>
  </div>

  <footer>
    Pokémon API • IGME 430 Project 1 Example
  </footer>

  <script>
    // Collapsible behavior like the example
    (function () {
      var headers = document.getElementsByClassName('collapsible');
      for (var i = 0; i < headers.length; i++) {
        headers[i].addEventListener('click', function () {
          var content = this.nextElementSibling;
          if (!content) return;
          var isOpen = content.style.display === 'block';
          content.style.display = isOpen ? 'none' : 'block';
        });
      }
      // Start with everything collapsed
      var contents = document.getElementsByClassName('content');
      for (var j = 0; j < contents.length; j++) contents[j].style.display = 'none';
    })();

    // ---------- Existing tester logic (unchanged) ----------
    var $ = function (id) { return document.getElementById(id); };
    var out = $('out');

    var show = function (res) {
      var headers = {};
      res.headers.forEach(function (v, k) { headers[k] = v; });

      res.text().then(function (bodyText) {
        var parsed;
        try { parsed = bodyText ? JSON.parse(bodyText) : null; } catch (e) { parsed = bodyText; }

        out.textContent = JSON.stringify({
          url: res.url,
          ok: res.ok,
          status: res.status,
          statusText: res.statusText,
          headers: headers,
          body: parsed
        }, null, 2);
      }).catch(function (e) {
        out.textContent = 'Read error: ' + (e && e.message ? e.message : e);
      });
    };

    var GET  = function (url) { return fetch(url, { method: 'GET',  headers: { 'Accept': 'application/json' } }); };
    var HEAD = function (url) { return fetch(url, { method: 'HEAD', headers: { 'Accept': 'application/json' } }); };

    var POST_JSON = function (url, obj) {
      return fetch(url, {
        method: 'POST',
        headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' },
        body: JSON.stringify(obj || {})
      });
    };

    var POST_FORM = function (url, obj) {
      return fetch(url, {
        method: 'POST',
        headers: { 'Accept': 'application/json', 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(obj || {}).toString()
      });
    };

    // /pokemon
    $('btnPokemonGet').onclick = function () {
      var qs = new URLSearchParams();
      var type   = $('type').value.trim();
      var search = $('search').value.trim();
      var limit  = $('limit').value;
      var offset = $('offset').value;
      if (type) qs.set('type', type);
      if (search) qs.set('search', search);
      if (limit !== '') qs.set('limit', limit);
      if (offset !== '') qs.set('offset', offset);

      GET('/pokemon' + (qs.toString() ? ('?' + qs.toString()) : '')).then(show);
    };

    $('btnPokemonHead').onclick = function () {
      var qs = new URLSearchParams();
      var type   = $('type').value.trim();
      var search = $('search').value.trim();
      var limit  = $('limit').value;
      var offset = $('offset').value;
      if (type) qs.set('type', type);
      if (search) qs.set('search', search);
      if (limit !== '') qs.set('limit', limit);
      if (offset !== '') qs.set('offset', offset);

      HEAD('/pokemon' + (qs.toString() ? ('?' + qs.toString()) : '')).then(show);
    };

    // /pokemon/by
    $('btnByGet').onclick = function () {
      var id   = $('byId').value.trim();
      var name = $('byName').value.trim();
      var qs = new URLSearchParams();
      if (id) qs.set('id', id);
      if (name) qs.set('name', name);
      GET('/pokemon/by' + (qs.toString() ? ('?' + qs.toString()) : '')).then(show);
    };

    $('btnByHead').onclick = function () {
      var id   = $('byId').value.trim();
      var name = $('byName').value.trim();
      var qs = new URLSearchParams();
      if (id) qs.set('id', id);
      if (name) qs.set('name', name);
      HEAD('/pokemon/by' + (qs.toString() ? ('?' + qs.toString()) : '')).then(show);
    };

    // /types
    $('btnTypesGet').onclick = function () { GET('/types').then(show); };
    $('btnTypesHead').onclick = function () { HEAD('/types').then(show); };

    // /pokemon/random
    document.getElementById('btnRandomGet').onclick = function () {
      var n = document.getElementById('randCount').value;
      var qs = new URLSearchParams();
      if (n !== '') qs.set('count', n);
      GET('/pokemon/random' + (qs.toString() ? ('?' + qs.toString()) : '')).then(show);
    };

    document.getElementById('btnRandomHead').onclick = function () {
      var n = document.getElementById('randCount').value;
      var qs = new URLSearchParams();
      if (n !== '') qs.set('count', n);
      HEAD('/pokemon/random' + (qs.toString() ? ('?' + qs.toString()) : '')).then(show);
    };

    // /pokemon/add
    $('btnAdd').onclick = function () {
      var id   = $('addId').value.trim();
      var name = $('addName').value.trim();
      var type = $('addType').value.trim();
      var mode = $('addContentType').value;

      if (!id || !name) { out.textContent = 'Please provide id and name.'; return; }

      if (mode === 'json') {
        var payload = { id: Number(id), name: name };
        if (type) payload.type = type.split(',').map(function (s) { return s.trim(); }).filter(Boolean);
        POST_JSON('/pokemon/add', payload).then(show);
      } else {
        var payload2 = { id: id, name: name };
        if (type) payload2.type = type;
        POST_FORM('/pokemon/add', payload2).then(show);
      }
    };

    // /pokemon/update
    $('btnUpdate').onclick = function () {
      var id    = $('updId').value.trim();
      var field = $('updField').value.trim();
      var value = $('updValue').value.trim();
      var mode  = $('updContentType').value;

      if (!id || !field) { out.textContent = 'Provide id and at least one field/value.'; return; }

      if (mode === 'json') {
        var payload = { id: Number(id) };
        var n = Number(value);
        payload[field] = Number.isNaN(n) ? value : n;
        POST_JSON('/pokemon/update', payload).then(show);
      } else {
        var payload2 = { id: id };
        payload2[field] = value;
        POST_FORM('/pokemon/update', payload2).then(show);
      }
    };
  </script>
</body>
</html>
